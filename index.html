<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"> 
<title>Suno Global Canvas (Mobile Pro 2.1)</title>
<style>
/* --- 1. –°–¢–ò–õ–¨ IbisPaint X (–û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ô) --- */
:root {
  --main-bg: #121212;
  --top-bar-bg: #222222;
  --control-bg: #333333;
  --accent-color: #008cff;
  --text-color: #f0f0f0;
  --border-color: #555;
  --danger-color: #ff3b30;
}

body {
  margin: 0;
  background: var(--main-bg);
  color: var(--text-color);
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  overflow-y: auto; 
  -webkit-tap-highlight-color: transparent;
  -webkit-font-smoothing: antialiased;
}

/* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
#top {
  background: var(--top-bar-bg);
  padding: 8px;
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  justify-content: flex-start;
  align-items: center;
  border-bottom: 1px solid var(--border-color);
  overflow-x: auto;
  position: sticky;
  top: 0;
  z-index: 100;
}

/* –ö–Ω–æ–ø–∫–∏ –∏ –∏–Ω–ø—É—Ç—ã: –£–í–ï–õ–ò–ß–ï–ù–ù–´–ô –†–ê–ó–ú–ï–† –î–õ–Ø –¢–ï–õ–ï–§–û–ù–ê */
button, input:not([type=range]) {
  background: var(--control-bg);
  color: var(--text-color);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  padding: 10px 12px;
  font-size: 14px;
  cursor: pointer;
  transition: 0.2s;
  flex-shrink: 0;
}
button:hover { background: #4a4a4a; border-color: var(--accent-color); }
.danger-btn { border-color: var(--danger-color) !important; color: var(--danger-color) !important; }

/* –ü–æ–ª–∑—É–Ω–∫–∏: –§–ò–ö–° –î–õ–Ø –°–ö–†–û–õ–õ–ê (Range) */
input[type=range] {
  -webkit-appearance: none;
  background: var(--border-color);
  height: 8px;
  border-radius: 4px;
}
input[type=range]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: var(--accent-color);
  cursor: pointer;
}

.control-group {
  display: flex;
  align-items: center;
  gap: 5px;
  margin-right: 10px;
}
.control-group label { font-size: 13px; color: #aaa; }
.control-group input[type=number] { width: 50px; text-align: center; padding: 5px; }


/* --- 2. –¶–ï–ù–¢–†–ê–õ–¨–ù–ê–Ø –û–ë–õ–ê–°–¢–¨ –ò –•–û–õ–°–¢ --- */
#main-content {
    display: flex;
    justify-content: center;
    padding: 20px;
    min-height: calc(100vh - 70px);
    box-sizing: border-box;
    overflow: hidden; 
}

canvas {
  display: block;
  border: 2px solid var(--accent-color);
  border-radius: 8px;
  box-shadow: 0 0 20px rgba(0, 140, 255, 0.2);
  background: #fff;
  user-select: none;
  -webkit-user-select: none; 
}


/* --- 3. –ò–ù–°–¢–†–£–ú–ï–ù–¢–´ –ò –¶–í–ï–¢–ê --- */
#tools {
  position: fixed; left: 0; top: 60px; width: 55px; background: var(--control-bg); padding: 10px 0;
  border-right: 1px solid var(--border-color); 
  display: flex; /* –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –§–ò–ö–°: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
  flex-direction: column; gap: 20px;
  align-items: center; z-index: 50; height: calc(100vh - 60px);
}
.tool-button { padding: 10px; font-size: 28px; }
.tool-button.active { color: var(--accent-color); text-shadow: 0 0 5px var(--accent-color); }

#color-panel {
    display: none; /* –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –§–ò–ö–°: –°–∫—Ä—ã–≤–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
    position: fixed; right: 0; top: 60px; width: 220px; background: var(--control-bg);
    padding: 15px; border-left: 1px solid var(--border-color); flex-direction: column; gap: 12px;
    z-index: 50; height: calc(100vh - 60px); overflow-y: auto;
}
#colorPreview { width: 100%; height: 50px; border-radius: 6px; border: 2px solid var(--text-color); }

.rgb-slider-group { display: flex; flex-direction: column; gap: 5px; }
.rgb-slider-group label { font-size: 14px; display: flex; justify-content: space-between; }


/* --- 4. –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –Ø–ó–´–ö–ê –ò –ì–ê–õ–ï–†–ï–Ø --- */
#language-modal, #gallery {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.95);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 3000;
    transition: opacity 0.3s;
}
#language-content {
    background: var(--control-bg);
    padding: 25px;
    border-radius: 10px;
    width: 300px;
    max-height: 80vh;
    overflow-y: auto;
}
.gallery-header { padding: 10px 0; }
.gallery-item img { height: 100px; }

#loader { color: #0f0; font-weight: bold; margin-left: 10px; display: none; }
</style>
</head>
<body>

<div id="top">
  <button id="btn_tools" onclick="window.toggleToolsPanel()">‚öôÔ∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</button>
  <button id="btn_color" onclick="window.toggleColorPanel()">üåà –¶–≤–µ—Ç/–†–∞–∑–º–µ—Ä</button>
  <button id="btn_gallery" onclick="window.toggleGallery()">üåç –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ì–∞–ª–µ—Ä–µ—è</button>
  <button id="btn_lang" onclick="window.toggleLanguageModal()">üåê –Ø–∑—ã–∫</button> 
  
  <button id="btn_global_save" onclick="window.saveToFirebase()" style="border-color: var(--danger-color); color: var(--danger-color);">‚òÅÔ∏è –í –ì–ª–æ–±–∞–ª!</button>
  <button id="btn_download" onclick="window.downloadCanvas()">üíæ –°–∫–∞—á–∞—Ç—å –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</button>
  <button id="btn_clear" onclick="window.clearCanvas()" class="danger-btn">üóë –°—Ç–µ—Ä–µ—Ç—å</button>
  <span id="loader">–ó–∞–≥—Ä—É–∑–∫–∞...</span>

    <div class="control-group">
        <label id="lbl_width">–®–∏—Ä–∏–Ω–∞:</label>
        <input type="number" id="canvasW" min="100" max="2000" value="360" onchange="window.resizeCanvas()">
    </div>
    <div class="control-group">
        <label id="lbl_height">–í—ã—Å–æ—Ç–∞:</label>
        <input type="number" id="canvasH" min="100" max="2000" value="500" onchange="window.resizeCanvas()">
    </div>
</div>

<div id="tools">
    <button class="tool-button active" onclick="window.setMode('draw', this)" title="–ö–∏—Å—Ç—å">‚úèÔ∏è</button>
    <button class="tool-button" onclick="window.setMode('erase', this)" title="–õ–∞—Å—Ç–∏–∫">üßΩ</button>
    <button class="tool-button" onclick="window.setMode('fill', this)" title="–ó–∞–ª–∏–≤–∫–∞">‚¨õ</button>
</div>

<div id="color-panel">
    <h3 id="h3_color_panel">–ü–∞–Ω–µ–ª—å —Ü–≤–µ—Ç–∞ –∏ —Ä–∞–∑–º–µ—Ä–∞</h3>

    <div id="colorPreview"></div>
    
    <div class="rgb-slider-group">
        <label><span id="lbl_red">–ö—Ä–∞—Å–Ω—ã–π (R):</span> <span id="r_val">0</span></label>
        <input type="range" id="r" min="0" max="255" value="0" oninput="window.updateColorPreview()">
    </div>
    <div class="rgb-slider-group">
        <label><span id="lbl_green">–ó–µ–ª–µ–Ω—ã–π (G):</span> <span id="g_val">0</span></label>
        <input type="range" id="g" min="0" max="255" value="0" oninput="window.updateColorPreview()">
    </div>
    <div class="rgb-slider-group">
        <label><span id="lbl_blue">–°–∏–Ω–∏–π (B):</span> <span id="b_val">0</span></label>
        <input type="range" id="b" min="0" max="255" value="0" oninput="window.updateColorPreview()">
    </div>
    
    <hr style="border-color: #555; margin: 15px 0;">

    <div class="rgb-slider-group">
        <label><span id="lbl_brush_size">–†–∞–∑–º–µ—Ä –∫–∏—Å—Ç–∏:</span> <span id="size_val">5</span></label>
        <input type="range" id="size" min="1" max="80" value="5" oninput="document.getElementById('size_val').textContent = this.value;">
    </div>
</div>


<div id="main-content">
    <canvas id="canvas" width="360" height="500"></canvas>
</div>

<div id="gallery">
    <div class="gallery-header">
        <h2 id="h2_gallery_title" style="margin:0;">üåç –†–∏—Å—É–Ω–∫–∏ –∏–≥—Ä–æ–∫–æ–≤</h2>
        <button id="btn_gallery_close" onclick="window.toggleGallery()">‚ùå –ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <div id="galleryContent" class="gallery-grid"></div>
</div>

<div id="language-modal">
    <div id="language-content">
        <h3 id="h3_select_lang">–í—ã–±—Ä–∞—Ç—å —è–∑—ã–∫</h3>
        <button class="lang-btn" data-lang="ru" onclick="window.setLanguage('ru')">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
        <button class="lang-btn" data-lang="en" onclick="window.setLanguage('en')">üá∫üá∏ English</button>
        <button class="lang-btn" data-lang="az" onclick="window.setLanguage('az')">üá¶üáø Az…ôrbaycan dili</button>
        <button class="lang-btn" data-lang="tr" onclick="window.setLanguage('tr')">üáπüá∑ T√ºrk√ße</button>
        <button class="lang-btn" data-lang="zh" onclick="window.setLanguage('zh')">üá®üá≥ ‰∏≠Êñá (Chinese)</button>
        <button class="lang-btn" data-lang="es" onclick="window.setLanguage('es')">üá™üá∏ Espa√±ol</button>
        <button class="lang-btn" data-lang="fr" onclick="window.setLanguage('fr')">üá´üá∑ Fran√ßais</button>
    </div>
</div>


<script type="module">
  // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit, doc, updateDoc, increment, deleteDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  
  // --- –ù–ê–°–¢–†–û–ô–ö–ò FIREBASE ---
  const firebaseConfig = {
    apiKey: "AIzaSyCekB6vZ6qGAnvDO1LOA7OUGmA3zU1aLoA",
    authDomain: "suno-gallery.firebaseapp.com",
    projectId: "suno-gallery",
    storageBucket: "suno-gallery.firebasestorage.app",
    messagingSenderId: "314284584278",
    appId: "1:314284584278:web:97c5b91180562fd1c93af7",
    measurementId: "G-2J4PNZX4CV"
  };
  // -----------------------

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const galleryRef = collection(db, "drawings"); 

  // --- –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –ì–ï–ù–ï–†–ê–¶–ò–Ø USER ID ---
  let USER_ID = localStorage.getItem("user_id");
  if (!USER_ID) {
      USER_ID = 'user_' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
      localStorage.setItem("user_id", USER_ID);
  }

  // --- –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –≠–õ–ï–ú–ï–ù–¢–´ ---
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  const colorPreview = document.getElementById("colorPreview");
  const rEl = document.getElementById("r");
  const gEl = document.getElementById("g");
  const bEl = document.getElementById("b");
  const sizeEl = document.getElementById("size");
  const loader = document.getElementById("loader");
  const toolButtons = document.querySelectorAll('.tool-button');

  window.drawing = false;
  window.mode = "draw";
  window.isOneFingerDrawing = false; 

  // --- I18N: –°–õ–û–í–ê–†–¨ –ü–ï–†–ï–í–û–î–û–í ---
  const translations = {
      'btn_tools': {'ru': '‚öôÔ∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã', 'en': '‚öôÔ∏è Tools', 'az': '‚öôÔ∏è Al…ôtl…ôr', 'tr': '‚öôÔ∏è Ara√ßlar', 'zh': '‚öôÔ∏è Â∑•ÂÖ∑', 'es': '‚öôÔ∏è Herramientas', 'fr': '‚öôÔ∏è Outils'},
      'btn_color': {'ru': 'üåà –¶–≤–µ—Ç/–†–∞–∑–º–µ—Ä', 'en': 'üåà Color/Size', 'az': 'üåà R…ông/√ñl√ß√º', 'tr': 'üåà Renk/Boyut', 'zh': 'üåà È¢úËâ≤/Â∞∫ÂØ∏', 'es': 'üåà Color/Tama√±o', 'fr': 'üåà Couleur/Taille'},
      'btn_gallery': {'ru': 'üåç –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ì–∞–ª–µ—Ä–µ—è', 'en': 'üåç Global Gallery', 'az': 'üåç Qlobal Qalereya', 'tr': 'üåç K√ºresel Galeri', 'zh': 'üåç ÂÖ®ÁêÉÁîªÂªä', 'es': 'üåç Galer√≠a Global', 'fr': 'üåç Galerie Globale'},
      'btn_lang': {'ru': 'üåê –Ø–∑—ã–∫', 'en': 'üåê Language', 'az': 'üåê Dil', 'tr': 'üåê Dil', 'zh': 'üåê ËØ≠Ë®Ä', 'es': 'üåê Idioma', 'fr': 'üåê Langue'},
      'btn_global_save': {'ru': '‚òÅÔ∏è –í –ì–ª–æ–±–∞–ª!', 'en': '‚òÅÔ∏è To Global!', 'az': '‚òÅÔ∏è Qlobal Y√ºkl…ô!', 'tr': '‚òÅÔ∏è Global Kaydet!', 'zh': '‚òÅÔ∏è ‰∏ä‰º†!', 'es': '‚òÅÔ∏è ¬°A Global!','fr': '‚òÅÔ∏è Publier !'},
      'btn_download': {'ru': 'üíæ –°–∫–∞—á–∞—Ç—å –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ', 'en': 'üíæ Download', 'az': 'üíæ Cihaza Y√ºkl…ô', 'tr': 'üíæ Cihaza ƒ∞ndir', 'zh': 'üíæ ‰∏ãËΩΩ', 'es': 'üíæ Descargar', 'fr': 'üíæ T√©l√©charger'},
      'btn_clear': {'ru': 'üóë –°—Ç–µ—Ä–µ—Ç—å', 'en': 'üóë Clear', 'az': 'üóë T…ômizl…ô', 'tr': 'üóë Sil', 'zh': 'üóë Ê∏ÖÈô§', 'es': 'üóë Borrar', 'fr': 'üóë Effacer'},
      'lbl_width': {'ru': '–®–∏—Ä–∏–Ω–∞:', 'en': 'Width:', 'az': 'Eni:', 'tr': 'Geni≈ülik:', 'zh': 'ÂÆΩÂ∫¶:', 'es': 'Ancho:', 'fr': 'Largeur:'},
      'lbl_height': {'ru': '–í—ã—Å–æ—Ç–∞:', 'en': 'Height:', 'az': 'H√ºnd√ºrl√ºy√º:', 'tr': 'Y√ºkseklik:', 'zh': 'È´òÂ∫¶:', 'es': 'Alto:', 'fr': 'Hauteur:'},
      'h3_color_panel': {'ru': '–ü–∞–Ω–µ–ª—å —Ü–≤–µ—Ç–∞ –∏ —Ä–∞–∑–º–µ—Ä–∞', 'en': 'Color and Size Panel', 'az': 'R…ông v…ô √ñl√ß√º Paneli', 'tr': 'Renk ve Boyut Paneli', 'zh': 'È¢úËâ≤ÂíåÂ∞∫ÂØ∏', 'es': 'Panel de Color y Tama√±o', 'fr': 'Panneau Couleur/Taille'},
      'lbl_red': {'ru': '–ö—Ä–∞—Å–Ω—ã–π (R):', 'en': 'Red (R):', 'az': 'Qƒ±rmƒ±zƒ± (R):', 'tr': 'Kƒ±rmƒ±zƒ± (R):', 'zh': 'Á∫¢Ëâ≤ (R):', 'es': 'Rojo (R):', 'fr': 'Rouge (R):'},
      'lbl_green': {'ru': '–ó–µ–ª–µ–Ω—ã–π (G):', 'en': 'Green (G):', 'az': 'Ya≈üƒ±l (G):', 'tr': 'Ye≈üil (G):', 'zh': 'ÁªøËâ≤ (G):', 'es': 'Verde (G):', 'fr': 'Vert (G):'},
      'lbl_blue': {'ru': '–°–∏–Ω–∏–π (B):', 'en': 'Blue (B):', 'az': 'Mavi (B):', 'tr': 'Mavi (B):', 'zh': 'ËìùËâ≤ (B):', 'es': 'Azul (B):', 'fr': 'Bleu (B):'},
      'lbl_brush_size': {'ru': '–†–∞–∑–º–µ—Ä –∫–∏—Å—Ç–∏:', 'en': 'Brush Size:', 'az': 'Fƒ±r√ßa √ñl√ß√ºs√º:', 'tr': 'Fƒ±r√ßa Boyutu:', 'zh': 'ÁîªÁ¨îÂ§ßÂ∞è:', 'es': 'Tama√±o del Pincel:', 'fr': 'Taille du Pinceau:'},
      'h2_gallery_title': {'ru': 'üåç –†–∏—Å—É–Ω–∫–∏ –∏–≥—Ä–æ–∫–æ–≤', 'en': 'üåç Player Drawings', 'az': 'üåç Oyun√ßu R…ôsml…ôri', 'tr': 'üåç Oyuncu √áizimleri', 'zh': 'üåç Áé©ÂÆ∂Áîª‰Ωú', 'es': 'üåç Dibujos de Jugadores', 'fr': 'üåç Dessins des Joueurs'},
      'btn_gallery_close': {'ru': '‚ùå –ó–∞–∫—Ä—ã—Ç—å', 'en': '‚ùå Close', 'az': '‚ùå Baƒüla', 'tr': '‚ùå Kapat', 'zh': '‚ùå ÂÖ≥Èó≠', 'es': '‚ùå Cerrar', 'fr': '‚ùå Fermer'},
      'h3_select_lang': {'ru': '–í—ã–±—Ä–∞—Ç—å —è–∑—ã–∫', 'en': 'Select Language', 'az': 'Dil Se√ßin', 'tr': 'Dil Se√ßin', 'zh': 'ÈÄâÊã©ËØ≠Ë®Ä', 'es': 'Seleccionar Idioma', 'fr': 'Choisir la Langue'},
      'msg_size_error': {'ru': '–†–∞–∑–º–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 100x100 –¥–æ 2000x2000.', 'en': 'Size must be between 100x100 and 2000x2000.', 'az': '√ñl√ß√º 100x100 il…ô 2000x2000 arasƒ±nda olmalƒ±dƒ±r.', 'tr': 'Boyut 100x100 ve 2000x2000 arasƒ±nda olmalƒ±dƒ±r.', 'zh': 'Â∞∫ÂØ∏ÂøÖÈ°ªÂú®100x100Âà∞2000x2000‰πãÈó¥.', 'es': 'El tama√±o debe estar entre 100x100 y 2000x2000.', 'fr': 'La taille doit √™tre comprise entre 100x100 et 2000x2000.'},
      'msg_publish_confirm': {'ru': '–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ä–∏—Å—É–Ω–æ–∫?', 'en': 'Publish drawing?', 'az': 'R…ôsmi d…ôrc edim?', 'tr': '√áizimi yayƒ±nlamak ister misiniz?', 'zh': 'ÂèëÂ∏ÉÁîª‰Ωú?', 'es': '¬øPublicar dibujo?', 'fr': 'Publier le dessin ?'},
      'msg_publish_success': {'ru': '–£—Ä–∞! –†–∏—Å—É–Ω–æ–∫ —Ç–µ–ø–µ—Ä—å –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –≥–∞–ª–µ—Ä–µ–µ.', 'en': 'Hooray! Drawing is now in the global gallery.', 'az': '∆èla! R…ôsm qlobal qalereyadadƒ±r.', 'tr': 'Harika! √áizim artƒ±k global galeride.', 'zh': 'ËÄ∂ÔºÅÁîª‰ΩúÂ∑≤Âú®ÁîªÂªä‰∏≠„ÄÇ', 'es': '¬°Hurra! El dibujo est√° en la galer√≠a global.', 'fr': 'Hourra! Le dessin est dans la galerie globale.'},
      'msg_vote_confirm': {'ru': '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å –∑–∞ —É–¥–∞–ª–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (18+/—à–æ–∫)? –í–∞—à –≥–æ–ª–æ—Å –±—É–¥–µ—Ç –∑–∞—Å—á–∏—Ç–∞–Ω.', 'en': 'Are you sure you want to vote to delete this content (18+/shock)? Your vote will be counted.', 'az': 'Bu m…ôzmunun (18+/≈üok) silinm…ôsi √º√ß√ºn s…ôs verm…ôk ist…ôdiyiniz…ô …ôminsinizmi? S…ôsiniz sayƒ±lacaq.', 'tr': 'Bu i√ßeriƒüin silinmesi i√ßin oy kullanmak istediƒüinizden emin misiniz? Oylarƒ±nƒ±z sayƒ±lacaktƒ±r.', 'zh': 'ÊÇ®Á°ÆÂÆöË¶ÅÊäïÁ•®Âà†Èô§Ê≠§ÂÜÖÂÆπÂêó?', 'es': '¬øEst√° seguro de votar para eliminar este contenido?', 'fr': 'Voulez-vous vraiment voter pour supprimer ce contenu ?'},
      'msg_already_voted': {'ru': '–í—ã —É–∂–µ –≥–æ–ª–æ—Å–æ–≤–∞–ª–∏ –∑–∞ —É–¥–∞–ª–µ–Ω–∏–µ —ç—Ç–æ–≥–æ —Ä–∏—Å—É–Ω–∫–∞!', 'en': 'You have already voted to delete this drawing!', 'az': 'Bu r…ôsmin silinm…ôsi √º√ß√ºn artƒ±q s…ôs vermisiniz!', 'tr': 'Bu √ßizimi silmek i√ßin zaten oy kullandƒ±nƒ±z!', 'zh': 'ÊÇ®Â∑≤ÊäïÁ•®!', 'es': '¬°Ya has votado!', 'fr': 'Vous avez d√©j√† vot√© !'},
      'msg_deleted': {'ru': '–†–∏—Å—É–Ω–æ–∫ –Ω–∞–±—Ä–∞–ª 10 –≥–æ–ª–æ—Å–æ–≤ –∏ –±—ã–ª —É–¥–∞–ª–µ–Ω –∏–∑ –≥–∞–ª–µ—Ä–µ–∏.', 'en': 'The drawing received 10 votes and was deleted from the gallery.', 'az': 'R…ôsm 10 s…ôs topladƒ± v…ô qalereyadan silindi.', 'tr': '√áizim 10 oy aldƒ± ve silindi.', 'zh': 'Áîª‰ΩúÂ∑≤Âà†Èô§„ÄÇ', 'es': 'Dibujo eliminado.', 'fr': 'Dessin supprim√©.'},
      'msg_vote_counted': (count) => ({'ru': `–í–∞—à –≥–æ–ª–æ—Å –∑–∞—Å—á–∏—Ç–∞–Ω. –ì–æ–ª–æ—Å–æ–≤ –∑–∞ —É–¥–∞–ª–µ–Ω–∏–µ: ${count}/10`, 'en': `Your vote has been counted. Votes for deletion: ${count}/10`, 'az': `S…ôsiniz sayƒ±ldƒ±. Silinm…ô √º√ß√ºn s…ôs: ${count}/10`, 'tr': `Oylarƒ±nƒ±z sayƒ±ldƒ±. Silme oyu: ${count}/10`, 'zh': `ÊÇ®ÁöÑÊäïÁ•®Â∑≤ËÆ°ÂÖ•„ÄÇÂà†Èô§Á•®Êï∞: ${count}/10`, 'es': `Su voto ha sido contado. Votos para eliminar: ${count}/10`, 'fr': `Votre vote a √©t√© compt√©. Votes pour la suppression: ${count}/10`}),
      'msg_gallery_empty': {'ru': '–ì–∞–ª–µ—Ä–µ—è –ø—É—Å—Ç–∞. –ù–∞—Ä–∏—Å—É–π —á—Ç–æ-–Ω–∏–±—É–¥—å –ø–µ—Ä–≤—ã–º!', 'en': 'Gallery is empty. Draw something first!', 'az': 'Qalereya bo≈üdur. Birinci siz r…ôsm √ß…ôkin!', 'tr': 'Galeri bo≈ü. ƒ∞lk siz √ßizin!', 'zh': 'ÁîªÂªäÊòØÁ©∫ÁöÑ„ÄÇ', 'es': 'La galer√≠a est√° vac√≠a.', 'fr': 'La galerie est vide.'},
      'msg_already_voted_btn': {'ru': '–£–∂–µ –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–Ω–æ', 'en': 'Already voted', 'az': 'Artƒ±q s…ôs verilib', 'tr': 'Zaten oy verildi', 'zh': 'Â∑≤ÊäïÁ•®', 'es': 'Ya votado', 'fr': 'D√©j√† vot√©'},
      'msg_vote_delete_btn': {'ru': '–£–¥–∞–ª–∏—Ç—å', 'en': 'Delete', 'az': 'Sil', 'tr': 'Sil', 'zh': 'Âà†Èô§', 'es': 'Eliminar', 'fr': 'Supprimer'},
      'msg_load_confirm': {'ru': '–ó–∞–≥—Ä—É–∑–∏—Ç—å —ç—Ç–æ—Ç —Ä–∏—Å—É–Ω–æ–∫ –Ω–∞ —Ö–æ–ª—Å—Ç?', 'en': 'Load this drawing onto the canvas?', 'az': 'Bu r…ôsmi k…ôtan √ºz…ôrin…ô y√ºkl…ôyim?', 'tr': 'Bu √ßizimi tuvale y√ºklemek ister misiniz?', 'zh': 'Âä†ËΩΩÊ≠§Áîª‰Ωú?', 'es': '¬øCargar este dibujo?', 'fr': 'Charger ce dessin ?'}
  };
  
  // –¢–µ–∫—É—â–∏–π —è–∑—ã–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä—É—Å—Å–∫–∏–π, –∏–ª–∏ –±–µ—Ä–µ–º –∏–∑ localStorage)
  let currentLang = localStorage.getItem('suno_lang') || 'ru';
  
  window.getTranslation = (key, ...args) => {
      const translation = translations[key];
      if (translation && translation[currentLang]) {
          if (typeof translation[currentLang] === 'function') {
              return translation[currentLang](...args);
          }
          return translation[currentLang];
      }
      return translations[key] ? translations[key]['ru'] : key; 
  };
  
  window.applyLanguage = () => {
      document.getElementById('btn_tools').textContent = window.getTranslation('btn_tools');
      document.getElementById('btn_color').textContent = window.getTranslation('btn_color');
      document.getElementById('btn_gallery').textContent = window.getTranslation('btn_gallery');
      document.getElementById('btn_lang').textContent = window.getTranslation('btn_lang');
      document.getElementById('btn_global_save').textContent = window.getTranslation('btn_global_save');
      document.getElementById('btn_download').textContent = window.getTranslation('btn_download');
      document.getElementById('btn_clear').textContent = window.getTranslation('btn_clear');
      document.getElementById('lbl_width').textContent = window.getTranslation('lbl_width');
      document.getElementById('lbl_height').textContent = window.getTranslation('lbl_height');
      
      document.getElementById('h3_color_panel').textContent = window.getTranslation('h3_color_panel');
      document.getElementById('lbl_red').textContent = window.getTranslation('lbl_red');
      document.getElementById('lbl_green').textContent = window.getTranslation('lbl_green');
      document.getElementById('lbl_blue').textContent = window.getTranslation('lbl_blue');
      document.getElementById('lbl_brush_size').textContent = window.getTranslation('lbl_brush_size');

      document.getElementById('h2_gallery_title').textContent = window.getTranslation('h2_gallery_title');
      document.getElementById('btn_gallery_close').textContent = window.getTranslation('btn_gallery_close');
      
      document.getElementById('h3_select_lang').textContent = window.getTranslation('h3_select_lang');

      document.querySelectorAll('.lang-btn').forEach(btn => {
          btn.classList.remove('active');
          if (btn.getAttribute('data-lang') === currentLang) {
              btn.classList.add('active');
          }
      });
  };

  window.setLanguage = (lang) => {
      currentLang = lang;
      localStorage.setItem('suno_lang', lang);
      window.applyLanguage();
      window.toggleLanguageModal();
  };
  
  window.toggleLanguageModal = () => {
      const modal = document.getElementById('language-modal');
      modal.style.display = (getComputedStyle(modal).display === "flex") ? "none" : "flex";
  };


  // --- 1. –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø UI ---

  window.toggleToolsPanel = () => {
      const tools = document.getElementById("tools");
      tools.style.display = (getComputedStyle(tools).display === "flex") ? "none" : "flex";
  }
  
  window.toggleColorPanel = () => {
      const colorPanel = document.getElementById("color-panel");
      colorPanel.style.display = (getComputedStyle(colorPanel).display === "flex") ? "none" : "flex";
  }

  window.toggleGallery = () => {
    const g = document.getElementById("gallery");
    const isHidden = (getComputedStyle(g).display === "none" || getComputedStyle(g).
