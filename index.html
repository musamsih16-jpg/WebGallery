<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Suno Global Canvas (Touch Fixed)</title>
<style>
:root {
  --main-bg: #121212;
  --top-bar-bg: #222222;
  --control-bg: #333333;
  --accent-color: #008cff;
  --text-color: #f0f0f0;
}

body {
  margin: 0;
  padding: 0;
  background: var(--main-bg);
  color: var(--text-color);
  font-family: sans-serif;
  display: flex;
  flex-direction: column;
  height: 100vh;
  overflow: hidden;
}

/* --- –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ (–¢–ï–ü–ï–†–¨ –§–ò–ö–°–ò–†–û–í–ê–ù–ù–ê–Ø –í –ü–û–¢–û–ö–ï) --- */
#top {
  background: var(--top-bar-bg);
  padding: 10px;
  display: flex;
  gap: 10px;
  align-items: center;
  border-bottom: 2px solid #444;
  overflow-x: auto;
  white-space: nowrap;
  flex-shrink: 0; /* –ù–µ –¥–∞–µ—Ç –º–µ–Ω—é —Å–∂–∏–º–∞—Ç—å—Å—è */
  z-index: 9999;
}

button {
  background: var(--control-bg);
  color: #fff;
  border: 1px solid #555;
  border-radius: 6px;
  padding: 12px 16px; /* –£–≤–µ–ª–∏—á–∏–ª –æ–±–ª–∞—Å—Ç—å –Ω–∞–∂–∞—Ç–∏—è */
  font-size: 16px;
  cursor: pointer;
  -webkit-appearance: none; /* –£–±–∏—Ä–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å—Ç–∏–ª–∏ iOS */
}

button:active {
  background: var(--accent-color);
}

/* --- –ö–û–ù–¢–ï–ô–ù–ï–† –•–û–õ–°–¢–ê --- */
#viewport {
  flex-grow: 1; /* –ó–∞–Ω–∏–º–∞–µ—Ç –≤—Å–µ –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –º–µ—Å—Ç–æ */
  position: relative;
  background: #1a1a1a;
  overflow: hidden;
  touch-action: none; /* –¢–æ–ª—å–∫–æ –∑–¥–µ—Å—å –±–ª–æ–∫–∏—Ä—É–µ–º –∂–µ—Å—Ç—ã –±—Ä–∞—É–∑–µ—Ä–∞ */
}

canvas {
  position: absolute;
  background: #fff;
  transform-origin: 0 0;
  box-shadow: 0 0 20px rgba(0,0,0,0.5);
}

/* --- –ü–ê–ù–ï–õ–ò --- */
#tools, #color-panel {
  position: fixed;
  top: 80px;
  background: rgba(40, 40, 40, 0.95);
  border: 1px solid #555;
  border-radius: 8px;
  padding: 15px;
  display: none;
  z-index: 10000;
  flex-direction: column;
  gap: 15px;
}

#tools { left: 10px; }
#color-panel { right: 10px; width: 220px; }

input[type=range] {
  width: 100%;
  height: 25px;
}

#gallery {
  position: fixed;
  inset: 0;
  background: #000;
  z-index: 20000;
  display: none;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
}
</style>
</head>
<body>

<div id="top">
  <button onclick="toggleElement('tools')">üõ† –ò–Ω—Å—Ç—Ä.</button>
  <button onclick="toggleElement('color-panel')">üé® –¶–≤–µ—Ç</button>
  <button onclick="toggleElement('gallery')">üåç –ì–∞–ª.</button>
  <button onclick="resetView()">üéØ –¶–µ–Ω—Ç—Ä</button>
  <button onclick="clearCanvas()" style="color:red">üóë –°—Ç–µ—Ä–µ—Ç—å</button>
</div>

<div id="tools">
    <button onclick="setMode('draw')">‚úèÔ∏è –ö–∏—Å—Ç—å</button>
    <button onclick="setMode('erase')">üßΩ –õ–∞—Å—Ç–∏–∫</button>
    <button onclick="setMode('fill')">‚¨õ –ó–∞–ª–∏–≤–∫–∞</button>
</div>

<div id="color-panel">
    <label>–†–∞–∑–º–µ—Ä: <span id="sz_val">5</span></label>
    <input type="range" id="size" min="1" max="100" value="5" oninput="document.getElementById('sz_val').innerText=this.value">
    <label>–¶–≤–µ—Ç (RGB):</label>
    <input type="range" id="r" max="255" value="0">
    <input type="range" id="g" max="255" value="0">
    <input type="range" id="b" max="255" value="0">
</div>

<div id="viewport" id="v">
    <canvas id="canvas" width="720" height="1280"></canvas>
</div>

<div id="gallery">
    <button onclick="toggleElement('gallery')" style="margin-bottom:20px">‚ùå –ó–∞–∫—Ä—ã—Ç—å</button>
    <div id="galleryContent">–¢—É—Ç –±—É–¥—É—Ç —Ä–∏—Å—É–Ω–∫–∏...</div>
</div>

<script>
// --- –ë–ê–ó–û–í–ê–Ø –õ–û–ì–ò–ö–ê ---
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const viewport = document.getElementById('viewport');

let scale = 1, pX = 0, pY = 0;
let isDrawing = false, mode = 'draw';
let lastX = 0, lastY = 0;

// –§—É–Ω–∫—Ü–∏–∏ UI
function toggleElement(id) {
    const el = document.getElementById(id);
    el.style.display = (el.style.display === 'flex') ? 'none' : 'flex';
}

function setMode(m) {
    mode = m;
    toggleElement('tools');
}

function clearCanvas() {
    ctx.fillStyle = "#fff";
    ctx.fillRect(0,0,canvas.width,canvas.height);
}

function resetView() {
    scale = 0.5;
    pX = (viewport.clientWidth - canvas.width * scale) / 2;
    pY = 20;
    updateTransform();
}

function updateTransform() {
    canvas.style.transform = `translate(${pX}px, ${pY}px) scale(${scale})`;
}

// --- –†–ò–°–û–í–ê–ù–ò–ï –ò –ñ–ï–°–¢–´ ---
function getPos(e) {
    const rect = viewport.getBoundingClientRect();
    const t = e.touches ? e.touches[0] : e;
    return {
        x: (t.clientX - rect.left - pX) / scale,
        y: (t.clientY - rect.top - pY) / scale
    };
}

let startDist = 0, startScale = 1, sX = 0, sY = 0;

viewport.addEventListener('touchstart', e => {
    if (e.touches.length === 2) {
        isDrawing = false;
        startDist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
        startScale = scale;
        sX = (e.touches[0].pageX + e.touches[1].pageX) / 2 - pX;
        sY = (e.touches[0].pageY + e.touches[1].pageY) / 2 - pY;
    } else {
        isDrawing = true;
        const p = getPos(e);
        lastX = p.x; lastY = p.y;
        if(mode === 'fill') {
            ctx.fillStyle = `rgb(${document.getElementById('r').value},${document.getElementById('g').value},${document.getElementById('b').value})`;
            ctx.fillRect(0,0,canvas.width,canvas.height);
        }
    }
}, {passive: false});

viewport.addEventListener('touchmove', e => {
    e.preventDefault();
    if (e.touches.length === 2) {
        const dist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
        scale = startScale * (dist / startDist);
        pX = (e.touches[0].pageX + e.touches[1].pageX) / 2 - sX;
        pY = (e.touches[0].pageY + e.touches[1].pageY) / 2 - sY;
        updateTransform();
    } else if (isDrawing) {
        const p = getPos(e);
        ctx.beginPath();
        ctx.globalCompositeOperation = (mode === 'erase') ? 'destination-out' : 'source-over';
        ctx.strokeStyle = `rgb(${document.getElementById('r').value},${document.getElementById('g').value},${document.getElementById('b').value})`;
        ctx.lineWidth = document.getElementById('size').value;
        ctx.lineCap = 'round';
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(p.x, p.y);
        ctx.stroke();
        lastX = p.x; lastY = p.y;
    }
}, {passive: false});

window.addEventListener('touchend', () => isDrawing = false);

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
clearCanvas();
setTimeout(resetView, 100);
</script>

</body>
</html>
